1. mq要考虑补偿机制，对于消费者，诸如rabbitmq，可以设置当业务执行发生异常时，mq会被不断重新消费，直到被正确消费为止，所以只要业务消费者保证数据的幂等性，就能保证消息不会丢失。

2. 对于发送者，如果我们发送mq失败了，需要分情况考虑：（1）对于不重要的场景，例如日志之类的偶尔发生发送失败，可以直接忽略。（2）如果数据重要，对于没有redis之类不能回滚的操作时，可以抛异常让本次处理按失败逻辑走。（3）、对于有redis这种无法回滚的操作时，只能catch住发送mq的异常，然后记录日志，通过报警通知，然后进行人为补偿。（4）、在（3）上可以改造成：将失败的消息落库，然后起调度循环补偿没有发送成功的消息。如果数据库同时也是失败了，只能打印日志，等待人为处理。